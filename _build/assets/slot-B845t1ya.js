import{v as J,a as x,g as X,w as Q,x as Y,e as C,n as ge,o as Z,y as A,z as ye,A as ve,u as we,B as ee,b as _e,D as be,f as xe,s as D}from"./web-BPZ8wtEZ.js";function Pe(){let e=new Set;function t(o){return e.add(o),()=>e.delete(o)}let n=!1;function r(o,s){if(n)return!(n=!1);const a={to:o,options:s,defaultPrevented:!1,preventDefault:()=>a.defaultPrevented=!0};for(const l of e)l.listener({...a,from:l.location,retry:h=>{h&&(n=!0),l.navigate(o,{...s,resolve:!1})}});return!a.defaultPrevented}return{subscribe:t,confirm:r}}let N;function te(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),N=window.history.state._depth}te();function Xe(e){return{...e,_depth:window.history.state&&window.history.state._depth}}function Qe(e,t){let n=!1;return()=>{const r=N;te();const o=r==null?null:N-r;if(n){n=!1;return}o&&t(o)?(n=!0,window.history.go(-o)):e()}}const Ce=/^(?:[a-z0-9]+:)?\/\//i,Re=/^\/+|(\/)\/+$/g,ke="http://sr";function O(e,t=!1){const n=e.replace(Re,"$1");return n?t||/^[?#]/.test(n)?n:"/"+n:""}function j(e,t,n){if(Ce.test(t))return;const r=O(e),o=n&&O(n);let s="";return!o||t.startsWith("/")?s=r:o.toLowerCase().indexOf(r.toLowerCase())!==0?s=r+o:s=o,(s||"/")+O(t,!s)}function Oe(e,t){if(e==null)throw new Error(t);return e}function Te(e,t){return O(e).replace(/\/*(\*.*)?$/g,"")+O(t)}function ne(e){const t={};return e.searchParams.forEach((n,r)=>{t[r]=n}),t}function Ie(e,t,n){const[r,o]=e.split("/*",2),s=r.split("/").filter(Boolean),a=s.length;return l=>{const h=l.split("/").filter(Boolean),f=h.length-a;if(f<0||f>0&&o===void 0&&!t)return null;const p={path:a?"":"/",params:{}},i=m=>n===void 0?void 0:n[m];for(let m=0;m<a;m++){const c=s[m],g=c[0]===":",y=g?h[m]:h[m].toLowerCase(),v=g?c.slice(1):c.toLowerCase();if(g&&M(y,i(v)))p.params[v]=y;else if(g||!M(y,v))return null;p.path+=`/${y}`}if(o){const m=f?h.slice(-f).join("/"):"";if(M(m,i(o)))p.params[o]=m;else return null}return p}}function M(e,t){const n=r=>r===e;return t===void 0?!0:typeof t=="string"?n(t):typeof t=="function"?t(e):Array.isArray(t)?t.some(n):t instanceof RegExp?t.test(e):!1}function Ee(e){const[t,n]=e.pattern.split("/*",2),r=t.split("/").filter(Boolean);return r.reduce((o,s)=>o+(s.startsWith(":")?2:3),r.length-(n===void 0?0:1))}function re(e){const t=new Map,n=X();return new Proxy({},{get(r,o){return t.has(o)||J(n,()=>t.set(o,x(()=>e()[o]))),t.get(o)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(e())}})}function oe(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let n=e.slice(0,t.index),r=e.slice(t.index+t[0].length);const o=[n,n+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(r);)o.push(n+=t[1]),r=r.slice(t[0].length);return oe(r).reduce((s,a)=>[...s,...o.map(l=>l+a)],[])}const Le=100,Se=Y(),Ae=Y(),se=()=>Oe(Q(Se),"<A> and 'use' router primitives can be only used inside a Route."),je=()=>se().navigatorFactory(),Ye=()=>se().params;function Fe(e,t=""){const{component:n,preload:r,load:o,children:s,info:a}=e,l=!s||Array.isArray(s)&&!s.length,h={key:e,component:n,preload:r||o,info:a};return ie(e.path).reduce((f,p)=>{for(const i of oe(p)){const m=Te(t,i);let c=l?m:m.split("/*",1)[0];c=c.split("/").map(g=>g.startsWith(":")||g.startsWith("*")?g:encodeURIComponent(g)).join("/"),f.push({...h,originalPath:p,pattern:c,matcher:Ie(c,!l,e.matchFilters)})}return f},[])}function Be(e,t=0){return{routes:e,score:Ee(e[e.length-1])*1e4-t,matcher(n){const r=[];for(let o=e.length-1;o>=0;o--){const s=e[o],a=s.matcher(n);if(!a)return null;r.unshift({...a,route:s})}return r}}}function ie(e){return Array.isArray(e)?e:[e]}function De(e,t="",n=[],r=[]){const o=ie(e);for(let s=0,a=o.length;s<a;s++){const l=o[s];if(l&&typeof l=="object"){l.hasOwnProperty("path")||(l.path="");const h=Fe(l,t);for(const f of h){n.push(f);const p=Array.isArray(l.children)&&l.children.length===0;if(l.children&&!p)De(l.children,f.pattern,n,r);else{const i=Be([...n],r.length);r.push(i)}n.pop()}}}return n.length?r:r.sort((s,a)=>a.score-s.score)}function U(e,t){for(let n=0,r=e.length;n<r;n++){const o=e[n].matcher(t);if(o)return o}return[]}function Me(e,t){const n=new URL(ke),r=x(h=>{const f=e();try{return new URL(f,n)}catch{return console.error(`Invalid path ${f}`),h}},n,{equals:(h,f)=>h.href===f.href}),o=x(()=>r().pathname),s=x(()=>r().search,!0),a=x(()=>r().hash),l=()=>"";return{get pathname(){return o()},get search(){return s()},get hash(){return a()},get state(){return t()},get key(){return l()},query:re(Z(s,()=>ne(r())))}}let b;function Ue(){return b}let R=!1;function Ne(){return R}function Ze(e){R=e}function et(e,t,n,r={}){const{signal:[o,s],utils:a={}}=e,l=a.parsePath||(u=>u),h=a.renderPath||(u=>u),f=a.beforeLeave||Pe(),p=j("",r.base||"");if(p===void 0)throw new Error(`${p} is not a valid base path`);p&&!o().value&&s({value:p,replace:!0,scroll:!1});const[i,m]=C(!1);let c;const g=(u,d)=>{d.value===y()&&d.state===_()||(c===void 0&&m(!0),b=u,c=d,A(()=>{c===d&&(v(c.value),ue(c.state),ye(),q[1]([]))}).finally(()=>{c===d&&ve(()=>{b=void 0,u==="navigate"&&de(c),m(!1),c=void 0})}))},[y,v]=C(o().value),[_,ue]=C(o().state),I=Me(y,_),E=[],q=C([]),H=x(()=>typeof r.transformUrl=="function"?U(t(),r.transformUrl(I.pathname)):U(t(),I.pathname)),fe=re(()=>{const u=H(),d={};for(let w=0;w<u.length;w++)Object.assign(d,u[w].params);return d}),z={pattern:p,path:()=>p,outlet:()=>null,resolvePath(u){return j(p,u)}};return ge(Z(o,u=>g("native",u),{defer:!0})),{base:z,location:I,params:fe,isRouting:i,renderPath:h,parsePath:l,navigatorFactory:he,matches:H,beforeLeave:f,preloadRoute:me,singleFlight:r.singleFlight===void 0?!0:r.singleFlight,submissions:q};function pe(u,d,w){we(()=>{if(typeof d=="number"){d&&(a.go?a.go(d):console.warn("Router integration does not support relative routing"));return}const L=!d||d[0]==="?",{replace:F,resolve:P,scroll:B,state:k}={replace:!1,resolve:!L,scroll:!0,...w};let Ge;const S=P?u.resolvePath(d):j(L&&I.pathname||"",d);if(S===void 0)throw new Error(`Path '${d}' is not a routable path`);if(E.length>=Le)throw new Error("Too many redirects");const G=y();(S!==G||k!==_())&&(ee||f.confirm(S,w)&&(E.push({value:G,replace:F,scroll:B,state:_()}),g("navigate",{value:S,state:k})))})}function he(u){return u=u||Q(Ae)||z,(d,w)=>pe(u,d,w)}function de(u){const d=E[0];d&&(s({...u,replace:d.replace,scroll:d.scroll}),E.length=0)}function me(u,d={}){const w=U(t(),u.pathname),L=b;b="preload";for(let F in w){const{route:P,params:B}=w[F];P.component&&P.component.preload&&P.component.preload();const{preload:k}=P;R=!0,d.preloadData&&k&&J(n(),()=>k({params:B,location:{pathname:u.pathname,search:u.search,hash:u.hash,query:ne(u),state:null,key:""},intent:"preload"})),R=!1}b=L}}function tt(e,t,n,r){const{base:o,location:s,params:a}=e,{pattern:l,component:h,preload:f}=r().route,p=x(()=>r().path);h&&h.preload&&h.preload(),R=!0;const i=f?f({params:a,location:s,intent:b||"initial"}):void 0;return R=!1,{parent:t,pattern:l,path:p,outlet:()=>h?_e(h,{params:a,location:s,data:i,get children(){return n()}}):n(),resolvePath(c){return j(o.path(),c,p())}}}const $e="Location",Ke=5e3,We=18e4;let $=new Map;setInterval(()=>{const e=Date.now();for(let[t,n]of $.entries())!n[3].count&&e-n[0]>We&&$.delete(t)},3e5);function K(){return $}function T(e,t){e.GET&&(e=e.GET);const n=(...r)=>{const o=K(),s=Ue(),a=Ne(),h=X()?je():void 0,f=Date.now(),p=t+V(r);let i=o.get(p),m;if(be()&&!ee&&(m=!0,xe(()=>i[3].count--)),i&&i[0]&&(s==="native"||i[3].count||Date.now()-i[0]<Ke)){m&&(i[3].count++,i[3][0]()),i[2]==="preload"&&s!=="preload"&&(i[0]=f);let y=i[1];return s!=="preload"&&(y="then"in i[1]?i[1].then(g(!1),g(!0)):g(!1)(i[1]),s==="navigate"&&A(()=>i[3][1](i[0]))),a&&"then"in y&&y.catch(()=>{}),y}let c=D.context&&D.has(p)?D.load(p):e(...r);return i?(i[0]=f,i[1]=c,i[2]=s,s==="navigate"&&A(()=>i[3][1](i[0]))):(o.set(p,i=[f,c,s,C(f)]),i[3].count=0),m&&(i[3].count++,i[3][0]()),s!=="preload"&&(c="then"in c?c.then(g(!1),g(!0)):g(!1)(c)),a&&"then"in c&&c.catch(()=>{}),c;function g(y){return async v=>{if(v instanceof Response){const _=v.headers.get($e);if(_!==null){h&&_.startsWith("/")?A(()=>{h(_,{replace:!0})}):window.location.href=_;return}v.customBody&&(v=await v.customBody())}if(y)throw v;return v}}};return n.keyFor=(...r)=>t+V(r),n.key=t,n}T.set=(e,t)=>{const n=K(),r=Date.now();let o=n.get(e);o?(o[0]=r,o[1]=t,o[2]="preload"):(n.set(e,o=[r,t,,C(r)]),o[3].count=0)};T.clear=()=>K().clear();function V(e){return JSON.stringify(e,(t,n)=>qe(n)?Object.keys(n).sort().reduce((r,o)=>(r[o]=n[o],r),{}):n)}function qe(e){let t;return e!=null&&typeof e=="object"&&(!(t=Object.getPrototypeOf(e))||t===Object.prototype)}function ae(){return{id:"",gamemode:0,maxPlayers:0,script:0}}function He(e){const t=ae();return{id:e.resource_id!==void 0?e.resource_id:t.id,gamemode:e.resource_mode!==void 0?e.resource_mode:t.gamemode,maxPlayers:e.resource_max_player!==void 0?e.resource_max_player:t.maxPlayers,script:e.sandbox_script!==void 0?e.sandbox_script:t.script}}function ce(){return{id:"",map:ae(),parent:"",title:"",description:"",creatorName:"",categoryType:0,permissionType:0,tags:[],playCounts:0,likeCounts:0,bookmarkCounts:0,cubeCounts:0,cheeringKingName:"",savegroupId:"",imageId:"",groupId:"",noticeType:0,eventType:0}}Object.assign(ce(),{id:"management"});const ze="/thumbnails/default.webp",nt=T(async e=>e||ze,"slot_thumbnail");function le(e,t){let n;t.imageId?n=e.vmg(t.imageId).href:t.map;let r="";return t.map&&(r=e.vxl(t.map.id).href),{imageUrl:n,mapUrl:r}}function W(e){const t=ce();return{id:e.id!==void 0?e.id:t.id,map:e.resource_id!==void 0?He(e):t.map,parent:e.parents_slot_id?W(e.parents_slot_id):t.parent,title:e.title!==void 0?e.title:t.title,description:e.description!==void 0?e.description:t.description,creatorName:e.creator_nickname!==void 0?e.creator_nickname:t.creatorName,categoryType:e.slot_category!==void 0?e.slot_category:t.categoryType,permissionType:e.permission!==void 0?e.permission:t.permissionType,tags:e.tags!==void 0?e.tags:t.tags,playCounts:e.play_count!==void 0?e.play_count:t.playCounts,likeCounts:e.like_count!==void 0?e.like_count:t.likeCounts,bookmarkCounts:e.bookmark_count!==void 0?e.bookmark_count:t.bookmarkCounts,cubeCounts:e.cube_count!==void 0?e.cube_count:t.cubeCounts,cheeringKingName:e.cheering_king!==void 0?e.cheering_king:t.cheeringKingName,savegroupId:e.savegroup_id!==void 0?e.savegroup_id:t.savegroupId,imageId:e.image_id!==void 0?e.image_id:t.imageId,groupId:e.group_id!==void 0?e.group_id:t.groupId,noticeType:e.notice_type!==void 0?e.notice_type:t.noticeType,eventType:e.is_event!==void 0?e.is_event:t.eventType}}const rt=T(async(e,t)=>{let n={};try{const o=await e.api(`v5/slots/simple?ids=${t}`);Object.assign(n,o[0])}catch{}Object.assign(n,await e.api(`v6/slots/detail/${t}`));const r=W(n);return r._html=le(e,r),r},"slot_by_id"),ot=T(async e=>{const t=await e.api("v6/slots/list/all");for(const n of Object.values(t))for(const r in n){const o=W(n[r]);o._html=le(e,o),n[r]=o}return t},"slot_list_all");export{Se as R,ze as S,et as a,Ae as b,De as c,tt as d,te as e,Pe as f,Ue as g,ot as h,Ye as i,rt as j,Xe as k,ke as m,Qe as n,Ze as s,je as u,nt as v};
