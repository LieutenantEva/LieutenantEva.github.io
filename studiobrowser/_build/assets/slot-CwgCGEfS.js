import{e as S,w as N,D as A,f as M,G as v,g as P,s as k}from"./web-9koFeCQo.js";import{l as x,g as $,t as j}from"./region-iEmnAcDk.js";const U="Location",Z=5e3,B=18e4;let w=new Map;setInterval(()=>{const e=Date.now();for(let[t,o]of w.entries())!o[3].count&&e-o[0]>B&&w.delete(t)},3e5);function I(){return w}function _(e,t){e.GET&&(e=e.GET);const o=(...i)=>{const s=I(),r=$(),c=j(),l=P()?x():void 0,p=Date.now(),m=t+O(i);let n=s.get(m),b;if(N()&&!A&&(b=!0,M(()=>n[3].count--)),n&&n[0]&&(r==="native"||n[3].count||Date.now()-n[0]<Z)){b&&(n[3].count++,n[3][0]()),n[2]==="preload"&&r!=="preload"&&(n[0]=p);let f=n[1];return r!=="preload"&&(f="then"in n[1]?n[1].then(d(!1),d(!0)):d(!1)(n[1]),r==="navigate"&&v(()=>n[3][1](n[0]))),c&&"then"in f&&f.catch(()=>{}),f}let u=k.context&&k.has(m)?k.load(m):e(...i);return n?(n[0]=p,n[1]=u,n[2]=r,r==="navigate"&&v(()=>n[3][1](n[0]))):(s.set(m,n=[p,u,r,S(p)]),n[3].count=0),b&&(n[3].count++,n[3][0]()),r!=="preload"&&(u="then"in u?u.then(d(!1),d(!0)):d(!1)(u)),c&&"then"in u&&u.catch(()=>{}),u;function d(f){return async g=>{if(g instanceof Response){const h=g.headers.get(U);if(h!==null){l&&h.startsWith("/")?v(()=>{l(h,{replace:!0})}):window.location.href=h;return}g.customBody&&(g=await g.customBody())}if(f)throw g;return g}}};return o.keyFor=(...i)=>t+O(i),o.key=t,o}_.set=(e,t)=>{const o=I(),i=Date.now();let s=o.get(e);s?(s[0]=i,s[1]=t,s[2]="preload"):(o.set(e,s=[i,t,,S(i)]),s[3].count=0)};_.clear=()=>I().clear();function O(e){return JSON.stringify(e,(t,o)=>H(o)?Object.keys(o).sort().reduce((i,s)=>(i[s]=o[s],i),{}):o)}function H(e){let t;return e!=null&&typeof e=="object"&&(!(t=Object.getPrototypeOf(e))||t===Object.prototype)}function C(){return{id:"",gamemode:-1,maxPlayers:0,script:0}}function R(e){const t=C();return Object.assign(t,{id:e.resource_id!==void 0?e.resource_id:t.id,gamemode:e.resource_mode!==void 0?e.resource_mode:t.gamemode,maxPlayers:e.resource_max_player!==void 0?e.resource_max_player:t.maxPlayers,script:e.sandbox_script!==void 0?e.sandbox_script:t.script})}const F={0:"Original",2:"Team Deathmatch",5:"Bot Team Deathmatch",8:"Zombie Classic",9:"Zombie Mutant",14:"Zombie Hero",16:"Soccer",20:"Zombie Escape",22:"Gun Deathmatch",23:"Basic",24:"Bot Zombie",38:"Create",39:"Play",40:"All-Star",45:"Zombie Z",49:"Hide and Seek",52:"Zombie Shelter",53:"Scenario TX",54:"Zombie Evolution",[-1]:"!!!ERROR_FIXME!!!"};function E(){return{id:"",map:C(),parent:"",title:"",description:"",creatorName:"",categoryType:0,permissionType:0,tags:[],playCounts:0,likeCounts:0,bookmarkCounts:0,cubeCounts:0,cheeringKingName:"",savegroupId:"",imageId:"",groupId:"",noticeType:0,eventType:0}}Object.assign(E(),{id:"management"});const L="/studiobrowser/thumbnails",G=`${L}/default.webp`,V=_(async e=>e||G,"slot_thumbnail");function T(e,t){let o;t.imageId?o=e.vmg(t.imageId).href:t.map&&(o=`${L}/${t.map.gamemode}.webp`);let i="",s="",r="";const c=t.map;c&&(i=e.vxl(c.id).href,s=F[c.gamemode],r=new Date(Number.parseInt(c.id.substring(1,14))).toLocaleString());let a=new Date(Number.parseInt(t.id.substring(1,14))).toLocaleString();return{imageUrl:o,mapUrl:i,gamemodeName:s,createdDate:a,updatedDate:r}}function y(e){const t=E();return Object.assign(t,{id:e.id!==void 0?e.id:t.id,map:e.resource_id!==void 0?R(e):t.map,parent:e.parents_slot_id?y(e.parents_slot_id):t.parent,title:e.title!==void 0?e.title:t.title,description:e.description!==void 0?e.description:t.description,creatorName:e.creator_nickname!==void 0?e.creator_nickname:t.creatorName,categoryType:e.slot_category!==void 0?e.slot_category:t.categoryType,permissionType:e.permission!==void 0?e.permission:t.permissionType,tags:e.tags!==void 0?e.tags:t.tags,playCounts:e.play_count!==void 0?e.play_count:t.playCounts,likeCounts:e.like_count!==void 0?e.like_count:t.likeCounts,bookmarkCounts:e.bookmark_count!==void 0?e.bookmark_count:t.bookmarkCounts,cubeCounts:e.cube_count!==void 0?e.cube_count:t.cubeCounts,cheeringKingName:e.cheering_king!==void 0?e.cheering_king:t.cheeringKingName,savegroupId:e.savegroup_id!==void 0?e.savegroup_id:t.savegroupId,imageId:e.image_id!==void 0?e.image_id:t.imageId,groupId:e.group_id!==void 0?e.group_id:t.groupId,noticeType:e.notice_type!==void 0?e.notice_type:t.noticeType,eventType:e.is_event!==void 0?e.is_event:t.eventType})}const X=_(async(e,t)=>{let o={},i=[];(await Promise.allSettled([e.api(`v6/slots/detail/${t}`),e.api(`v5/slots/simple?ids=${t}`)])).forEach(c=>{if(c.status=="fulfilled"){const a=c.value;Array.isArray(a)?Object.assign(o,a[0]):Object.assign(o,a)}else i.push(c.reason)});const r=y(o);return r._html=T(e,r),r._html.errors=i,r},"slot_by_id");async function D(e,t,o={}){const i=new URLSearchParams(o.queries||{});let s;switch(t){case"nick":s=`v5/slots/list/nick/${o.nickname}${i.size?`?${i}`:""}`;break;case"all":s="v6/slots/list/all";const a=await e.api("v6/slots/list/all");for(const l of Object.values(a))for(const p in l){const m=y(l[p]);m._html=T(e,m),l[p]=m}return a;default:throw new TypeError(`Unknown category "${t}"`)}const r=await e.api(s);return r.forEach((c,a)=>{const l=y(c);l._html=T(e,l),r[a]=l}),r}const z=_(async e=>await D(e,"all"),"slot_list_all"),J=_(async(e,t,o={})=>await D(e,"nick",{nickname:t,queries:o}),"slot_list_nick");export{G as S,J as a,X as b,_ as c,z as f,V as v};
