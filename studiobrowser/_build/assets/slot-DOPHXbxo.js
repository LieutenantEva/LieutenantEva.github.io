import{e as S,v as x,w as A,f as M,x as b,g as N,s as k}from"./web-DtRvhTJ7.js";import{u as P,g as $,r as j}from"./region-H5XRBcnw.js";const Z="Location",B=5e3,H=18e4;let w=new Map;setInterval(()=>{const e=Date.now();for(let[t,o]of w.entries())!o[3].count&&e-o[0]>H&&w.delete(t)},3e5);function I(){return w}function _(e,t){e.GET&&(e=e.GET);const o=(...i)=>{const s=I(),r=$(),c=j(),l=N()?P():void 0,m=Date.now(),u=t+O(i);let n=s.get(u),v;if(x()&&!A&&(v=!0,M(()=>n[3].count--)),n&&n[0]&&(r==="native"||n[3].count||Date.now()-n[0]<B)){v&&(n[3].count++,n[3][0]()),n[2]==="preload"&&r!=="preload"&&(n[0]=m);let d=n[1];return r!=="preload"&&(d="then"in n[1]?n[1].then(f(!1),f(!0)):f(!1)(n[1]),r==="navigate"&&b(()=>n[3][1](n[0]))),c&&"then"in d&&d.catch(()=>{}),d}let p=k.context&&k.has(u)?k.load(u):e(...i);return n?(n[0]=m,n[1]=p,n[2]=r,r==="navigate"&&b(()=>n[3][1](n[0]))):(s.set(u,n=[m,p,r,S(m)]),n[3].count=0),v&&(n[3].count++,n[3][0]()),r!=="preload"&&(p="then"in p?p.then(f(!1),f(!0)):f(!1)(p)),c&&"then"in p&&p.catch(()=>{}),p;function f(d){return async g=>{if(g instanceof Response){const h=g.headers.get(Z);if(h!==null){l&&h.startsWith("/")?b(()=>{l(h,{replace:!0})}):window.location.href=h;return}g.customBody&&(g=await g.customBody())}if(d)throw g;return g}}};return o.keyFor=(...i)=>t+O(i),o.key=t,o}_.set=(e,t)=>{const o=I(),i=Date.now();let s=o.get(e);s?(s[0]=i,s[1]=t,s[2]="preload"):(o.set(e,s=[i,t,,S(i)]),s[3].count=0)};_.clear=()=>I().clear();function O(e){return JSON.stringify(e,(t,o)=>U(o)?Object.keys(o).sort().reduce((i,s)=>(i[s]=o[s],i),{}):o)}function U(e){let t;return e!=null&&typeof e=="object"&&(!(t=Object.getPrototypeOf(e))||t===Object.prototype)}function C(){return{id:"",gamemode:-1,maxPlayers:0,script:0}}function F(e){const t=C();return{id:e.resource_id!==void 0?e.resource_id:t.id,gamemode:e.resource_mode!==void 0?e.resource_mode:t.gamemode,maxPlayers:e.resource_max_player!==void 0?e.resource_max_player:t.maxPlayers,script:e.sandbox_script!==void 0?e.sandbox_script:t.script}}const R={0:"Original",2:"Team Deathmatch",5:"Bot Team Deathmatch",8:"Zombie Classic",9:"Zombie Mutant",14:"Zombie Hero",16:"Soccer",20:"Zombie Escape",22:"Gun Deathmatch",23:"Basic",24:"Bot Zombie",38:"Create",39:"Play",40:"All-Star",45:"Zombie Z",49:"Hide and Seek",52:"Zombie Shelter",53:"Scenario TX",54:"Zombie Evolution",[-1]:"!!!ERROR_FIXME!!!"};function E(){return{id:"",map:C(),parent:"",title:"",description:"",creatorName:"",categoryType:0,permissionType:0,tags:[],playCounts:0,likeCounts:0,bookmarkCounts:0,cubeCounts:0,cheeringKingName:"",savegroupId:"",imageId:"",groupId:"",noticeType:0,eventType:0}}Object.assign(E(),{id:"management"});const D="/studiobrowser/thumbnails",q=`${D}/default.webp`,V=_(async e=>e||q,"slot_thumbnail");function T(e,t){let o;t.imageId?o=e.vmg(t.imageId).href:t.map&&(o=`${D}/${t.map.gamemode}.webp`);let i="",s="",r="";const c=t.map;c&&(i=e.vxl(c.id).href,s=R[c.gamemode],r=new Date(Number.parseInt(c.id.substring(1,14))).toLocaleString());let a=new Date(Number.parseInt(t.id.substring(1,14))).toLocaleString();return{imageUrl:o,mapUrl:i,gamemodeName:s,createdDate:a,updatedDate:r}}function y(e){const t=E();return{id:e.id!==void 0?e.id:t.id,map:e.resource_id!==void 0?F(e):t.map,parent:e.parents_slot_id?y(e.parents_slot_id):t.parent,title:e.title!==void 0?e.title:t.title,description:e.description!==void 0?e.description:t.description,creatorName:e.creator_nickname!==void 0?e.creator_nickname:t.creatorName,categoryType:e.slot_category!==void 0?e.slot_category:t.categoryType,permissionType:e.permission!==void 0?e.permission:t.permissionType,tags:e.tags!==void 0?e.tags:t.tags,playCounts:e.play_count!==void 0?e.play_count:t.playCounts,likeCounts:e.like_count!==void 0?e.like_count:t.likeCounts,bookmarkCounts:e.bookmark_count!==void 0?e.bookmark_count:t.bookmarkCounts,cubeCounts:e.cube_count!==void 0?e.cube_count:t.cubeCounts,cheeringKingName:e.cheering_king!==void 0?e.cheering_king:t.cheeringKingName,savegroupId:e.savegroup_id!==void 0?e.savegroup_id:t.savegroupId,imageId:e.image_id!==void 0?e.image_id:t.imageId,groupId:e.group_id!==void 0?e.group_id:t.groupId,noticeType:e.notice_type!==void 0?e.notice_type:t.noticeType,eventType:e.is_event!==void 0?e.is_event:t.eventType}}const X=_(async(e,t)=>{let o={},i=[];(await Promise.allSettled([e.api(`v6/slots/detail/${t}`),e.api(`v5/slots/simple?ids=${t}`)])).forEach(c=>{if(c.status=="fulfilled"){const a=c.value;Array.isArray(a)?Object.assign(o,a[0]):Object.assign(o,a)}else i.push(c.reason)});const r=y(o);return r._html=T(e,r),r._html.errors=i,r},"slot_by_id");async function L(e,t,o={}){let i="";if(o.queries){const c=o.queries,a=Object.keys(c).length;a&&(i="?",Object.entries(c).forEach(([l,m],u)=>{i+=`${l}=${new String(m)}`,u<a-1&&(i+="&")}))}let s;switch(t){case"nick":s=`v5/slots/list/nick/${o.nickname}${i}`;break;case"all":s="v6/slots/list/all";const a=await e.api("v6/slots/list/all");for(const l of Object.values(a))for(const m in l){const u=y(l[m]);u._html=T(e,u),l[m]=u}return a;default:throw new TypeError(`Unknown category "${t}"`)}const r=await e.api(s);return r.forEach((c,a)=>{const l=y(c);l._html=T(e,l),r[a]=l}),r}const z=_(async e=>await L(e,"all"),"slot_list_all");_(async(e,t,o={})=>await L(e,"nick",{nickname:t,queries:o}),"slot_list_nick");export{q as S,X as a,z as f,V as v};
